<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Network Test - Mayna</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .pending { background-color: #fff3cd; border-color: #ffeaa7; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        .log { font-family: monospace; font-size: 12px; background: #f8f9fa; padding: 10px; margin: 10px 0; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>Mayna Network Test</h1>
    
    <div class="test-section pending" id="basicTest">
        <h3>1. Basic Network Test</h3>
        <p>Testing basic internet connectivity...</p>
        <button onclick="testBasicNetwork()">Run Test</button>
        <div id="basicResult"></div>
    </div>

    <div class="test-section pending" id="apiTest">
        <h3>2. API Connectivity Test</h3>
        <p>Testing connection to SeekTir API...</p>
        <button onclick="testAPI()">Run Test</button>
        <div id="apiResult"></div>
    </div>

    <div class="test-section pending" id="fetchTest">
        <h3>3. Fetch API Test</h3>
        <p>Testing fetch() functionality...</p>
        <button onclick="testFetch()">Run Test</button>
        <div id="fetchResult"></div>
    </div>

    <div class="test-section" id="envTest">
        <h3>4. Environment Detection</h3>
        <button onclick="checkEnvironment()">Check Environment</button>
        <div id="envResult"></div>
    </div>

    <div class="log" id="logOutput"></div>

    <script>
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logEl = document.getElementById('logOutput');
            logEl.innerHTML += `[${timestamp}] ${message}<br>`;
            console.log(message);
        }

        function updateTestResult(testId, success, message) {
            const testEl = document.getElementById(testId);
            const resultEl = document.getElementById(testId.replace('Test', 'Result'));
            
            testEl.className = `test-section ${success ? 'success' : 'error'}`;
            resultEl.innerHTML = `<strong>${success ? '‚úÖ PASSED' : '‚ùå FAILED'}</strong><br>${message}`;
        }

        async function testBasicNetwork() {
            log('üîç Testing basic network connectivity...');
            try {
                const response = await fetch('https://httpbin.org/get', {
                    method: 'GET',
                    mode: 'cors'
                });
                
                if (response.ok) {
                    const data = await response.json();
                    updateTestResult('basicTest', true, 'Basic network connectivity is working');
                    log('‚úÖ Basic network test passed');
                } else {
                    updateTestResult('basicTest', false, `HTTP ${response.status}: ${response.statusText}`);
                    log(`‚ùå Basic network test failed: ${response.status}`);
                }
            } catch (error) {
                updateTestResult('basicTest', false, `Error: ${error.message}`);
                log(`‚ùå Basic network test error: ${error.message}`);
            }
        }

        async function testAPI() {
            log('üîç Testing SeekTir API connectivity...');
            try {
                // Test without authentication first
                const response = await fetch('https://api.seektir.com/v2/user', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        phone_number: '09393070813'
                    })
                });
                
                const data = await response.json();
                
                if (response.status === 200 || response.status === 400) {
                    // 200 or 400 both indicate API is reachable
                    updateTestResult('apiTest', true, 'SeekTir API is reachable');
                    log('‚úÖ API connectivity test passed');
                } else {
                    updateTestResult('apiTest', false, `HTTP ${response.status}: ${data.message || 'Unknown error'}`);
                    log(`‚ùå API test failed: ${response.status}`);
                }
            } catch (error) {
                updateTestResult('apiTest', false, `Error: ${error.message}`);
                log(`‚ùå API test error: ${error.message}`);
            }
        }

        async function testFetch() {
            log('üîç Testing fetch() API functionality...');
            try {
                const testUrl = 'https://jsonplaceholder.typicode.com/posts/1';
                const response = await fetch(testUrl);
                
                if (response.ok) {
                    const data = await response.json();
                    updateTestResult('fetchTest', true, 'Fetch API is working correctly');
                    log('‚úÖ Fetch API test passed');
                } else {
                    updateTestResult('fetchTest', false, `HTTP ${response.status}: ${response.statusText}`);
                    log(`‚ùå Fetch API test failed: ${response.status}`);
                }
            } catch (error) {
                updateTestResult('fetchTest', false, `Error: ${error.message}`);
                log(`‚ùå Fetch API test error: ${error.message}`);
            }
        }

        function checkEnvironment() {
            log('üîç Checking environment details...');
            
            const isCapacitor = window.Capacitor && window.Capacitor.isNativePlatform();
            const isCordova = !!window.cordova;
            const platform = window.Capacitor ? window.Capacitor.getPlatform() : 'web';
            const userAgent = navigator.userAgent;
            
            const envInfo = `
                <strong>Environment Details:</strong><br>
                Capacitor: ${isCapacitor ? '‚úÖ Yes' : '‚ùå No'}<br>
                Native Platform: ${isCapacitor ? '‚úÖ Yes' : '‚ùå No'}<br>
                Cordova: ${isCordova ? '‚úÖ Yes' : '‚ùå No'}<br>
                Platform: ${platform}<br>
                User Agent: ${userAgent.substring(0, 100)}...
            `;
            
            document.getElementById('envResult').innerHTML = envInfo;
            log(`üì± Environment: Capacitor=${isCapacitor}, Platform=${platform}`);
        }

        // Auto-run environment check
        window.addEventListener('DOMContentLoaded', checkEnvironment);
    </script>
</body>
</html>